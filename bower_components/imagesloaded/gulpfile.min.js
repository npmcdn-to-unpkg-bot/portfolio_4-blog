function rjsOptimize(t){t=t||{},requirejs.define("node/print",[],function(){return function(t){"Error"===t.substring(0,5)?gutil.log(chalk.red(t)):gutil.log(t)}});var e=through.obj(function(i,s,n){return i.isNull()?n(null,i):(t.logLevel=2,t.out=function(t){var e=new gutil.File({path:i.relative,contents:new Buffer(t)});n(null,e)},gutil.log("RequireJS optimizing"),void requirejs.optimize(t,null,function(t){var i=new gutil.PluginError("requirejsOptimize",t.message);e.emit("error",i)}))});return e}function getBanner(){var t=fs.readFileSync("imagesloaded.js","utf8"),e=t.match(reBannerComment),i=e[0].replace("imagesLoaded","imagesLoaded PACKAGED");return i}function addBanner(t){return replace(/^/,t)}var fs=require("fs"),gulp=require("gulp"),rename=require("gulp-rename"),replace=require("gulp-replace"),jshint=require("gulp-jshint");gulp.task("hint-js",function(){return gulp.src("imagesloaded.js").pipe(jshint()).pipe(jshint.reporter("default"))}),gulp.task("hint-test",function(){return gulp.src("test/unit/*.js").pipe(jshint()).pipe(jshint.reporter("default"))}),gulp.task("hint-task",function(){return gulp.src("gulpfile.js").pipe(jshint()).pipe(jshint.reporter("default"))});var jsonlint=require("gulp-json-lint");gulp.task("jsonlint",function(){return gulp.src("*.json").pipe(jsonlint()).pipe(jsonlint.report("verbose"))}),gulp.task("hint",["hint-js","hint-test","hint-task","jsonlint"]);var gutil=require("gulp-util"),through=require("through2"),requirejs=require("requirejs"),chalk=require("chalk"),reBannerComment=new RegExp("^\\s*(?:\\/\\*[\\s\\S]*?\\*\\/)\\s*");gulp.task("requirejs",function(){var t=getBanner();return gulp.src("imagesloaded.js").pipe(rjsOptimize({baseUrl:"bower_components",optimize:"none",include:["../imagesloaded"]})).pipe(replace("'../imagesloaded',","")).pipe(addBanner(t)).pipe(rename("imagesloaded.pkgd.js")).pipe(gulp.dest("."))});var uglify=require("gulp-uglify");gulp.task("uglify",["requirejs"],function(){var t=getBanner();gulp.src("imagesloaded.pkgd.js").pipe(uglify()).pipe(addBanner(t)).pipe(rename("imagesloaded.pkgd.min.js")).pipe(gulp.dest("."))});var minimist=require("minimist");gulp.task("version",function(){var t=minimist(process.argv.slice(3)),e=t.t;if(!e||!/\d+\.\d+\.\d+/.test(e))return void gutil.log("invalid version: "+chalk.red(e));gutil.log("ticking version to "+chalk.green(e)),gulp.src("imagesloaded.js").pipe(replace(/imagesLoaded v\d+\.\d+\.\d+/,"imagesLoaded v"+e)).pipe(gulp.dest(".")),gulp.src(["bower.json","package.json"]).pipe(replace(/"version": "\d+\.\d+\.\d+"/,'"version": "'+e+'"')).pipe(gulp.dest("."));var i=e.match(/^\d+\.\d+/)[0];gulp.src("README.md").pipe(replace(/imagesloaded@\d+\.\d+/g,"imagesloaded@"+i)).pipe(gulp.dest("."))}),gulp.task("default",["hint","uglify"]);