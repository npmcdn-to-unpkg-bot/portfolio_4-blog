myApp.factory("userModel",["$http","$location","ngNotify","$cookies","$timeout",function(t,e,n,r,a){var i=new Object;return i.doLogin=function(e,i){return 0==i.$valid?n.set("Некорректные данные, повторите еще раз",{type:"error",position:"top"}):void t({method:"POST",url:"/auth",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:e}).success(function(t){if(1==e.remember){var s=new Date;s.setDate(s.getDate()+365),r.put("auth",JSON.stringify(t),{expires:s})}else"undefined"!=typeof Storage&&window.sessionStorage.setItem("auth",!0);return n.set("Вход успешно выполнен",{type:"success",position:"top"}),a(function(){window.location.href="/"},750)}).error(function(t){return n.set(t,{type:"error",position:"top"})})},i.getAuthStatus=function(e){i.check=void 0==r.get("auth")?!1:!0,void 0!==typeof Storage&&window.sessionStorage.getItem("auth")?i.check=!0:e?t({url:"/api/checkAuth",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"GET"}).success(function(t){if(i.check)return!0;var e=new Date;e.setDate(e.getDate()+365),r.put("auth",JSON.stringify(t),{expires:e}),i.check=!0}).error(function(){i.check&&r.remove("auth")}):i.check=!1},i.check=!1,i.getUserObject=function(){var t=angular.fromJson(r.get("auth"));return t},i.logout=function(){"undefined"!=typeof Storage&&window.sessionStorage.removeItem("auth"),r.remove("auth"),t.post("/logout"),window.location.href="/admin/auth"},i}]),myApp.factory("search",["$http","ngNotify",function(t){return{result:{item:{id:"value",title:"value",date:"value"},item2:{id:"value",title:"value",date:"value"}},getNews:function(){this.result=void 0;var e=this.form.search.$modelValue;void 0!=e&&e.length>=3&&t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"GET",url:"/api/search?str="+e}).success(function(){this.result=!1}.bind(this)).error(function(){this.result=!1}.bind(this))}}}]),myApp.factory("newsModel",["$http","ngNotify","Upload","$timeout","$location",function(t,e,n,r,a){var i=function(){this.items=[],this.busy=!1,this.page=1,this.data=new Object};return i.prototype.getList=function(){this.busy||(this.busy=!0,t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"GET",url:"/api/news/list?page="+this.page}).success(function(t){if(0==t.total)return this.busy=!0;var r=JSON.parse(JSON.stringify(t.data));for(var a in r){for(var i in r[a].paths)"main"==r[a].paths[i].type&&(r[a].paths[0].path=r[a].paths[i].path);this.items.push(r[a])}t.last_page>this.page?(this.page++,this.busy=!1):this.busy=!0}.bind(this)).error(function(t,n){return e.set("Сервер не отвечает: "+n,{type:"error",position:"top"})}))},i.prototype.add=function(t,i){return{push:function(){for(var e in t)i.images.all.push(t[e]);return i},upload:function(){var o=new Object;for(var s in i.images)if(Array.isArray(i.images[s]))for(var u in i.images[s])o[u]=i.images[s][u];else o[s]=i.images[s];var c=n.upload({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/api/news/add",data:{file:o,description:t.description.$modelValue,title:t.title.$modelValue,tags:t.tags.$modelValue}});c.then(function(){r(function(){a.path("/")},700),r(function(){return e.set("Новость опубликована",{type:"success",position:"top"})})},function(t){return e.set(t.data,{type:"error",position:"top"})})},edit:function(){var o=new Object,s=new Object;for(var u in i.images.all)"string"!=typeof i.images.all[u]&&(s[u]=i.images.all[u]);if(s.left=i.images.left,s.right=i.images.right,0!=i.deleteImg.remove.length)for(var u in i.deleteImg.remove)o[i.deleteImg.remove[u]]=i.paths[i.deleteImg.remove[u]];var c=n.upload({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/api/news/edit/"+i.id,data:{file:s,deleteImg:o,description:t.description.$modelValue,title:t.title.$modelValue,id:i.id}});c.then(function(){r(function(){a.path("/")},700),r(function(){return e.set("Новость изменена",{type:"success",position:"top"})})},function(t){return e.set(t.data,{type:"error",position:"top"})})},remove:function(t){return void 0!=i.deleteImg&&i.deleteImg.remove.push(i.deleteImg.all[t]),i.images.all.splice(t,1)}}},i.prototype.edit=function(n){t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"GET",url:"/api/news/getById/"+n}).success(function(t){this.data=t.data[n],this.data.images={all:new Array},this.data.deleteImg={all:new Array,remove:new Array};for(var a in this.data.paths)this.data.images.all.push(t.data[n].paths[a]),this.data.deleteImg.all.push(a);this.oldData={description:this.data.description,title:this.data.title,images:this.data.images.all.length}}.bind(this)).error(function(t,n){return e.set(n,{type:"error",position:"top"})})},i.prototype.delete=function(n){1==confirm("Удалить новость?")&&t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",url:"/api/news/delete",data:{id:n.id,paths:n.paths}}).success(function(){r(function(){a.path("/")},700),r(function(){return e.set("Новость удалена",{type:"success",position:"top"})})}).error(function(t,n){return e.set(n,{type:"error",position:"top"})})},i}]),myApp.factory("newsDetailModel",["$http","ngNotify","$location","$timeout",function(t,e,n,r){var a=new Object;return a.getPage=function(e,i){return t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"GET",url:"/api/news/getById/"+e}).success(function(t){a.params=JSON.parse(JSON.stringify(t.data))[e],i(a.params)}).error(function(){r(function(){n.path("/")})}),a},a}]),myApp.factory("feedBeck",["$http","ngNotify",function(t){return{submit:function(){return t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",data:this.data,url:"/api/feedback"}),this.delete()},"delete":function(){return this.data=null,!1}}}]),myApp.factory("profile",["$http","ngNotify","Upload",function(t,e,n){var r=function(){this.getData={submit:new String},this.form=new Object};return r.prototype.update=function(){var r={headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",data:new Object},a=new String;switch(this.getData.submit){case"description":r.url="/admin/profile/changeDescription",r.data.description=this.form.description.$viewValue,a="Текст изменен";break;case"ava":r.url="/admin/profile/changeAvatar",r.data.file=this.getData.ava;var i=n.upload(r);return i.then(function(){return e.set("Аватарка изменена",{type:"success",position:"top"})},function(t){return e.set(t.data,{type:"error",position:"top"})}),!0;case"password":r.url="/admin/profile/changePassword",r.data={old_password:this.form.old_password.$viewValue,password:this.form.password.$viewValue,password_confirmed:this.form.password_confirmed.$viewValue},a="Пароль изменен"}r.url&&t(r).success(function(){return e.set(a,{type:"success",position:"top"})}).error(function(t){return e.set(t.data,{type:"error",position:"top"})})},r.prototype.get=function(){var n=this;return{description:function(){t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/api/information/description",method:"GET"}).success(function(t){this.getData.description=t}.bind(n)).error(function(t){return e.set(t.data,{type:"error",position:"top"})})},ava:function(){t({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/api/information/avatar",method:"GET"}).success(function(t){this.getData.ava=t}.bind(n)).error(function(t){return e.set(t.data,{type:"error",position:"top"})})}}},r}]);