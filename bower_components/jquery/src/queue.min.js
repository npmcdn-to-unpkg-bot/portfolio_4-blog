define(["./core","./data/var/dataPriv","./deferred","./callbacks"],function(t,e){return t.extend({queue:function(n,r,i){var s;return n?(r=(r||"fx")+"queue",s=e.get(n,r),i&&(!s||t.isArray(i)?s=e.access(n,r,t.makeArray(i)):s.push(i)),s||[]):void 0},dequeue:function(e,n){n=n||"fx";var r=t.queue(e,n),i=r.length,s=r.shift(),o=t._queueHooks(e,n),a=function(){t.dequeue(e,n)};"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===n&&r.unshift("inprogress"),delete o.stop,s.call(e,a,o)),!i&&o&&o.empty.fire()},_queueHooks:function(n,r){var i=r+"queueHooks";return e.get(n,i)||e.access(n,i,{empty:t.Callbacks("once memory").add(function(){e.remove(n,[r+"queue",i])})})}}),t.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),arguments.length<r?t.queue(this[0],e):void 0===n?this:this.each(function(){var r=t.queue(this,e,n);t._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&t.dequeue(this,e)})},dequeue:function(e){return this.each(function(){t.dequeue(this,e)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(n,r){var i,s=1,o=t.Deferred(),a=this,l=this.length,u=function(){--s||o.resolveWith(a,[a])};for("string"!=typeof n&&(r=n,n=void 0),n=n||"fx";l--;)i=e.get(a[l],n+"queueHooks"),i&&i.empty&&(s++,i.empty.add(u));return u(),o.promise(r)}}),t});