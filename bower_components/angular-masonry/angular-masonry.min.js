!function(){"use strict";angular.module("wu.masonry",[]).controller("MasonryCtrl",["$scope","$element","$timeout",function(e,t,n){function u(e){e.addClass("loaded")}var r={},i=[],o=!1,s=this,a=null;this.preserveOrder=!1,this.loadImages=!0,this.scheduleMasonryOnce=function(){var e=arguments,t=i.filter(function(t){return t[0]===e[0]}).length>0;t||this.scheduleMasonry.apply(null,arguments)},this.scheduleMasonry=function(){a&&n.cancel(a),i.push([].slice.call(arguments)),a=n(function(){o||(i.forEach(function(e){t.masonry.apply(t,e)}),i=[])},30)},this.addBrick=function(e,n,i){function a(){0===Object.keys(r).length&&t.masonry("resize"),void 0===r[i]&&(r[i]=!0,u(n),t.masonry(e,n,!0))}function l(){s.scheduleMasonryOnce("layout")}o||(s.loadImages?s.preserveOrder?(a(),n.imagesLoaded(l)):n.imagesLoaded(function(){a(),l()}):(a(),l()))},this.removeBrick=function(e,n){o||(delete r[e],t.masonry("remove",n),this.scheduleMasonryOnce("layout"))},this.destroy=function(){o=!0,t.data("masonry")&&t.masonry("destroy"),e.$emit("masonry.destroyed"),r={}},this.reload=function(){t.masonry(),e.$emit("masonry.reloaded")}}]).directive("masonry",function(){return{restrict:"AE",controller:"MasonryCtrl",link:{pre:function(e,t,n,r){var i=e.$eval(n.masonry||n.masonryOptions),o=angular.extend({itemSelector:n.itemSelector||".masonry-brick",columnWidth:parseInt(n.columnWidth,10)||n.columnWidth},i||{});t.masonry(o),e.masonryContainer=t[0];var s=e.$eval(n.loadImages);r.loadImages=s!==!1;var a=e.$eval(n.preserveOrder);r.preserveOrder=a!==!1&&void 0!==n.preserveOrder;var u=e.$eval(n.reloadOnShow);u!==!1&&void 0!==n.reloadOnShow&&e.$watch(function(){return t.prop("offsetParent")},function(e,t){e&&!t&&r.reload()});var l=e.$eval(n.reloadOnResize);l!==!1&&void 0!==n.reloadOnResize&&e.$watch("masonryContainer.offsetWidth",function(e,t){e!=t&&r.reload()}),e.$emit("masonry.created",t),e.$on("$destroy",r.destroy)}}}}).directive("masonryBrick",function(){return{restrict:"AC",require:"^masonry",scope:!0,link:{pre:function(e,t,n,r){var o,i=e.$id,s=e.$eval(n.prepend),a=s?"prepended":"appended";r.addBrick(a,t,i),t.on("$destroy",function(){r.removeBrick(i,t)}),e.$on("masonry.reload",function(){r.scheduleMasonryOnce("reloadItems"),r.scheduleMasonryOnce("layout")}),e.$watch("$index",function(){void 0!==o&&o!==e.$index&&(r.scheduleMasonryOnce("reloadItems"),r.scheduleMasonryOnce("layout")),o=e.$index})}}}})}();